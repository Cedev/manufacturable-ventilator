* C:\Users\Cedric\Documents\manufacturable-ventilator\ltspice\bubble_volume_test.asc
VDplus N003 0 1.405
Valph N004 0 0.20944
VBeta N002 0 0.0160524
Varea N001 0 13.921875
XX1 N004 N002 N003 N001 R theta arc x bubble_volume

* block symbol definitions
.subckt bubble_volume alph beta step area r theta arc x
Blength_past length_past 0 V=if(v(beta) > 0, v(r)-v(r)*cos(v(beta)-v(alph))-v(step)*cos(v(alph)), 0)
Btriangular_area N003 N004 V=0.5*cos(v(alph))*v(step)*v(x)
Bcurved_area N004 0 V=0.5*v(r)**2*(v(omega)-sin(v(omega)))
XX1 length_past r area_past NC_01 NC_02 chord
Barc 0 arc I=v(r)*(v(omega)) rpar=1
Ealph N001 0 alph 0 1
Egamma gamma N001 beta 0 1
Gr 0 r_solved r_solved 0 1
Rr r_solved 0 1
Gerror 0 r_solved bubble_area N002 1
Btheta 0 theta I=acos(cos(v(gamma))-v(step)*cos(v(alph))/v(r)) rpar=1
Eomega omega gamma theta 0 1
Earea_past bubble_area N003 0 area_past 1
XX2 step nc
Bx 0 x I=cos(v(beta)-v(omega)/2)*v(step)/sin(v(omega)/2-v(gamma)) rpar=1
XX3 area nc
Barea N002 0 V=uramp(v(area))
Br 0 r I=abs(v(r_solved)) rpar=1
.ends bubble_volume

.subckt chord h radius A r theta
Btheta 0 theta I=2*acos(v(r)/v(radius)) rpar=1
BA 0 A I=0.5*v(radius)**2*(v(theta) - sin(v(theta))) rpar=1
Er r 0 radius h 1
.ends chord

.subckt nc x
XX1 x NC_01 id
.ends nc

.subckt id x id_x
G1 0 id_x x 0 1
R1 id_x 0 1
.ends id

.dc Varea -2 100 0.1 VBeta -0.2 0.2 .01
.backanno
.end
