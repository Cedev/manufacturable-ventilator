* C:\Users\Cedric\Documents\manufacturable-ventilator\ltspice\amp.asc
V1 N004 0 {P0}
Lsupply N004 N005 {2*LGTHS/(H0*AREAS)/CS*redim_dQdt} Rser=0
Rsupply N005 Supply R=1/(CS**2)*absq2(i(Lsupply))
V2 0 NC_01 PULSE(0 1000 .004 1.5e-3 1.5e-3 1)
Lc1 0 N007 flux={2*LGTHC/(H0*AREAC)*redim_dQdt}/v(D1)*x Rser=0
Lc2 0 N001 flux={2*LGTHC/(H0*AREAC)*redim_dQdt}/v(D2)*x Rser=0
Rcontrol1 N007 C1 R=v(RC1)*absq2(i(Lc1))
Rcontrol2 N001 C2 R=v(RC2)*absq2(i(Lc2))
Lo1 N006 0 {2*LGTHR/(H0*AREAR)*redim_dQdt} Rser=0
Lo2 N003 0 {2*LGTHR/(H0*AREAR)*redim_dQdt} Rser=0
Ro2 pout2 N003 R=1/(AREAR**2)*absq2(i(Lo2))
Ro1 pout1 N006 R=1/(AREAR**2)*absq2(i(Lo1))
Lv1 N008 0 {2*LGTHV/(H0*AREAV)*redim_dQdt} Rser=0
Lv2 N002 0 {2*LGTHV/(H0*AREAV)*redim_dQdt} Rser=0
Rv2 PBubble2 N002 R=RVI*absq2(i(Lv2))
Rv1 PBubble1 N008 {R_blocked_vent}
B§QS QS 0 V=i(Lsupply)/redim_Q
B§QC1 QC1 0 V=i(Lc1)/redim_Q
B§QC2 QC2 0 V=i(Lc2)/redim_Q
B§QV1 QV1 0 V=i(Rv1)/redim_Q
B§QV2 QV2 0 V=i(Rv2)/redim_Q
B§QO1 QO1 0 V=i(Ro1)/redim_Q
B§QO2 QO2 0 V=i(Ro2)/redim_Q
B§D1_min D1_min 0 V=if(v(REC1)<2500, CDMAX, -(CDMAX-CDMIN)*v(REC1)/1e4+1.25*CDMAX-0.25*CDMIN)
B§D2_min D2_min 0 V=if(v(REC2)<2500, CDMAX, -(CDMAX-CDMIN)*v(REC2)/1e4+1.25*CDMAX-0.25*CDMIN)
B§REC1 REC1 0 V=abs(v(QC1)*RE)
B§REC2 REC2 0 V=abs(v(QC2)*RE)
B§FC1 FC1 0 V=(v(C1)/P0+2*(uramp(v(QC1))/BC)**2)*BC
B§FC2 FC2 0 V=(v(C2)/P0+2*(uramp(v(QC2))/BC)**2)*BC
B§FSY FSY 0 V=v(Supply)/P0+2*v(QS)**2
Bubble1 PB2 PBubble1 V=v(Active1)*v(delpb)
B§pc1 C1 PBubble1 V=v(Active1)*v(delpb)/2
B§pc2 C2 PBubble2 V=v(Active2)*v(delpb)/2
Bubble2 PB2 PBubble2 V=v(Active2)*v(delpb)
B§psy PB2 Supply V=v(delpb)*1/4
BETA BETA 0 V=atan(v(orient)*(v(FC1)-v(FC2))/eps(v(FSY)))
B§length_past length_past 0 V=uramp(v(R)-v(R)*cos(v(BETA)-ALPH)-A2)
B§area_past area_past 0 V=v(R)**2*acos((v(R)-v(length_past))/v(R))-(v(R)-v(length_past))*sqrt(2*v(R)*v(length_past)-v(length_past)**2)
B§V V 0 V=13.9 delay=0.00001
B§wedge_length wedge_length 0 V=A2/cos(v(BETA)+ALPH)
B§theta theta 0 V=acos(cos(v(BETA)+ALPH)-A2/v(r))
B§wedge_area wedge_area 0 V=0.5*sin(v(BETA))*(D+0.5)*v(wedge_length)
B§outside_area outside_area 0 V=0.5*(v(R)-v(wedge_length))*v(R)*sin(ALPH+v(BETA)+v(theta))
bubble_area bubble_area 0 V=0.5*v(R)**2*(ALPH+v(BETA)+v(theta))+v(wedge_area)-v(outside_area)-v(area_past)
R1 R 0 1
B3 0 R I=v(R)+if(v(R) >= 0, v(bubble_area)-v(V), v(R)+6)
B§TS TS 0 V=if(v(ZET) > pi/2 - v(theta) - ALPH, tanh(v(YS)*SIGMA/(v(SS)+SIGMA/3)), 1)
B§ZET ZET 0 V=atan(v(R)*cos(v(BETA))/(SPL-v(R)*sin(v(BETA))))
B§SS SS 0 V=v(R)*(v(BETA)-v(ZET)+pi/2)
B§YS YS 0 V=sqrt((v(R)*cos(v(BETA)))**2+(SPL-v(R)*sin(v(BETA)))**2)-v(R)
B§T T 0 V=2*cos((2*pi-acos(-v(B)/2))/3)
B B 0 V=1.5*(-v(TS)+(v(TS)**3/3)+2/3+(2/3+v(TS)-(v(TS)**3/3))*cos(v(THETA)))
A§State N009 N010 0 0 0 Active1 Active2 0 SRFLOP
B§To2 N009 0 V=if(2*v(R)*sin(v(BETA)) >= SPL, v(Active1), 0)
B§To1 N010 0 V=if(2*v(R)*sin(v(BETA)) >= SPL, v(Active2), 0)
B§orient orient 0 V=v(Active1)-v(Active2)
B§VBubble1 VBubble1 0 V=sdt(-i(Bubble1)/redim_Q, 6, v(Active2))
B§VBubble2 VBubble2 0 V=sdt(-i(Bubble2)/redim_Q, 6, v(Active1))
B§qr qr 0 V=0.5*i(Lsupply)*sqrt(A1*v(S1)+1)*(1-v(T))*v(Ramp)
B§qe qe 0 V=0.5*i(Lsupply)*(sqrt(A1*v(S1)+1)-1)*v(Ramp)
B§S1 S1 0 V=v(R)*(ALPH+v(BETA)+v(theta))
B§DYC DYC 0 V=-v(R)*cos(v(BETA))+sqrt((cos(v(BETA))*v(R))**2-BC*BC+2*BC*v(R)*sin(v(BETA)))
B§delpb delpb 0 V=2*redim_Q2*i(LSupply)**2/eps(v(R))*v(Ramp)**3
B§QR2 PBubble2 PB2 I=v(Active2)*v(qe)
B§QE1 PB2 PBubble1 I=v(Active1)*v(qe)
B§QE2 PB2 PBubble2 I=v(Active2)*v(qr)
B§QR1 PBubble1 PB2 I=v(Active1)*v(qr)
B§pda pda 0 V=redim_Q2*0.75*i(Rsupply)**2*(v(TS)+v(T)-(v(TS)**3+v(T)**3)/3)/AREAR*v(Ramp)
B§pdi pdi 0 V=redim_Q2*0.75*i(Rsupply)**2*(2/3-v(TS)+v(TS)**3/3)/AREAR*v(Ramp)
B§PD2 pout2 PB2 V=v(pdi)
B§PD1 pout1 PB2 V=v(pda)
B§RCMIN1 RCMIN1 0 V=1/(BC**2*v(D1_min)**2)
B§RCMIN2 RCMIN2 0 V=1/(BC**2*v(D2_min)**2)
B§RC1D RC1D 0 V=1/(eps(KC+v(orient)*v(DYC))**2)
B§RC2D RC2D 0 V=1/(eps(KC-v(orient)*v(DYC)**2))
B§RC1 RC1 0 V=max(min(v(RC1D), RCMAX), v(RCMIN1))
B§RC2 RC2 0 V=max(min(v(RC2D), RCMAX), v(RCMIN2))
B§D1 D1 0 V=if(v(RC1)==v(RC1D), 1, v(D1_min))
B§D2 D2 0 V=if(v(RC2)==v(RC2D), 1, v(D2_min))
B1 probe 0 V=atan(v(orient)*(v(FC1)-v(FC2))/v(FSY))
B2 probe2 0 V=redim_Q2*redim_Q
Cap PB2 0 {sin(ALPH)*(LGTHS*B0)**2/100}
V§Ramp Ramp 0 1
.param rho=1.2059 sigma=10 nu=1.4864e-5
.tran 50
.param D=0.905 B0=2.1e-3 BC=1 ALPH=.20944 XV1=8.640 LGTHC=10 AREAC=2 LGTHS=15 AREAS=3 LGTHV=10 AREAV=1.95 SPL=10 LGTHR=27.75 P0=10000 CS=0.85
.param H0=3*B0
.param Qref=B0*sqrt(2*P0/rho) RE=Qref/nu
.param redim_dQdt=B0/(H0*Qref**2) redim_Q2=rho/(2*H0**2*B0**2)
.param A1=3/sigma A2=(D+0.5)*cos(ALPH) A3=(D+0.5)*sin(ALPH) A4=(D+0.5)*tan(ALPH) AREAR=A2+SPL*sin(ALPH)
.param CDMAX=0.9 CDMIN=0.6
.param redim_Q=H0*Qref
.param KC=D+BC*tan(ALPH) RCMAX=1/(0.1414*BC)**2
.param RVI=1/AREAV**2
.param R_blocked_vent=redim_Q*redim_Q2*1e6
.func absq2(q) {redim_Q2*max(abs(q), redim_Q*0.0001)}
.option noopiter
.param epsilon=1e-5
.func eps(y) {y + if(y>=0, 1, -1)*epsilon/(1+exp(abs(y)/10))}
.backanno
.end
